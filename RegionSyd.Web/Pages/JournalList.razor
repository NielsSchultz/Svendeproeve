@page "/soeg-journal"
@inject IJournalService _journalService


<div class="container">
    <div class="row mb-4">

        <div class="col-6 mx-auto p-4" style="border: 1px solid #E6ECEF; border-radius:4px; background-color:#f3f3f3">
            <div class="row">
                <div class="col-10">
                    <input type="text" placeholder="Indtast cpr-nr" class="form-control" @bind="@Cpr" />
                </div>
                <div class="col-2">
                    <input type="button" class="btn btn-green w-100" @onclick="Search" value="Søg"></input>

                </div>
            </div>
        </div>

    </div>
    <div class="row">
        <div class="col-8 mx-auto" style="border: 1px solid #E6ECEF; border-radius:4px; padding:20px 40px">

            <h4>Journaler</h4>
            @if (Journals != null)
            {
                foreach (var journal in Journals)
                {

                    <div class="row p-2 mb-2" style="border: 1px solid #E6ECEF; border-radius:4px; background-color:#f3f3f3">
                        <div class="col-lg-3"><span class="fw-bold">@journal.Cpr</span> </div>
                        <div class="col-lg-6">
                            <span>@(Helpers.FullNameHelper.GetFullName(journal.FirstName, journal.MiddleName, journal.LastName))</span>
                        </div>
                        <div class="col-lg-3">
                            <div class="row">
                                <div class="col-6">
                                    <input class="btn btn-outline-dark btn-sm w-100" type="button" value="Rediger" />
                                </div> 
                                <div class="col-6">

                                    <input class="btn btn-danger btn-sm w-100" type="button" value="Slet" />
                                </div>
                            </div>
                        </div>
                    </div>

                }

            }
            else
            {
                <RadzenProgressBar ProgressBarStyle="ProgressBarStyle.Success" class="w-50 mx-auto mt-5" Value="100" ShowValue="false" Mode="ProgressBarMode.Indeterminate" />

            }

        </div>
    </div>
</div>







@code {

    List<JournalDTO> Journals { get; set; }
    string Message { get; set; }
    string Cpr { get; set; }

    protected override async Task OnInitializedAsync()
    {
        Journals = await _journalService.GetAll();
        StateHasChanged();

    }
    public void Search()
    {
        var result = Journals.Where(journal => journal.Cpr == Cpr).FirstOrDefault();
        if (result != null)
        {
            navigationManager.NavigateTo($"/journal? journalId={result.JournalId}");
        }
        else
            Message = "Kan ikke finde en journal med dette cpr nummer";
    }

    public void AddEditJournal()
    {

    }

    public void DeleteJournal()
    {

    }
    
    public async Task<CurrentUser> GetCurrentUserAsync()
    {
        return await localStorage.GetItemAsync<CurrentUser>(SessionConstants.CurrentUser);
    }


}
